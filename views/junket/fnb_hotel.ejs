<%- include('../partials/header') %>
<%- include('../partials/loader') %>
<%- include('../partials/sidebar') %>
<%- include('../partials/topbar') %>
<%
	const formatDate = (value) => {
		if (!value) return '-';
		const d = new Date(value);
		const pad = (n) => String(n).padStart(2, '0');
		const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
		return `${months[d.getMonth()]} ${d.getDate()}, ${d.getFullYear()} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
	};

	const paymentLabel = (transactionId) => {
		switch (transactionId) {
			case 1:
				return 'Cash';
			case 2:
				return 'Deposit';
			case 3:
				return 'Commission';
			default:
				return '-';
		}
	};
%>

<div class="container-fluid content-inner mt-4">
	<div class="row gy-3">
		<div class="col-12">
			<div class="card">
				<div class="card-header d-flex justify-content-between align-items-center">
					<h3 class="card-title mb-0">
						<div class="breadcrumb1 flat">
							<a href="/dashboard"><span class="fa fa-home"></span></a>
							<a href="#">F&B / Hotel</a>
							<a href="/fnb-hotel" class="active">Dashboard</a>
						</div>
					</h3>
					<div class="row mb-2">
						<div class="col-sm-12">
							<div id="fnb-hotel-filter" class="filter-breadcrumb-services">
								<a href="#" class="filter-link active" data-filter="all">All</a>
								<a href="#" class="filter-link" data-filter="fnb">F&B</a>
								<a href="#" class="filter-link" data-filter="hotel">Hotel</a>
								<a href="#" class="filter-link" data-filter="delivery">Delivery</a>
							</div>
						</div>
					</div>
					<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modal-services-new-record">
						<i class="fa fa-plus" aria-hidden="true"></i> New Record
					</button>
				</div>
				<div class="card-body">
					<div class="row mt-4">
						<div class="col-12">
							
							<div class="table-responsive">
								<table id="fnb-hotel-table" class="table table-striped align-middle text-center">
									<thead class="table-secondary">
											<tr>
												<th>Source</th>
												<th>Agent</th>
												<th>Game ID</th>
												<th>Service Type</th>
												<th>Amount</th>
												<th>Payment</th>
												<th>Remarks</th>
												<th>Encoded By</th>
												<th>Date</th>
											</tr>
									</thead>
									<tbody>
										<% if (gameServices && gameServices.length) { %>
											<% gameServices.forEach(service => { %>
												<%
												const amt = Number(service.AMOUNT) || 0;
												const hasDecimals = amt % 1 !== 0;
												const formattedAmt = hasDecimals
													? amt.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })
													: amt.toLocaleString('en-US');
												const isJunketSource = service.SOURCE_TYPE === 'JUNKET';
												const displayAmt = `${isJunketSource ? '-' : ''}${formattedAmt}`;
												%>
												<tr data-service-type="<%= service.SERVICE_TYPE %>">
													<td><%= service.SOURCE_TYPE || '-' %></td>
													<td><%= service.SOURCE_TYPE === 'JUNKET' ? '-' : (service.agent_name || 'Unknown') %></td>
													<td><%= service.GAME_ID ? service.GAME_ID : '-' %></td>
													<td><%= service.SERVICE_TYPE %></td>
													<td class="<%= isJunketSource ? 'text-danger' : '' %>"><%= displayAmt %></td>
													<td><%= paymentLabel(service.TRANSACTION_ID) %></td>
													<td><%= service.REMARKS || '-' %></td>
													<td><%= service.encoded_by_name || '-' %></td>
													<td><%= formatDate(service.ENCODED_DT) %></td>
												</tr>
											<% }) %>
										<% } else { %>
											<tr>
												<td colspan="9" class="text-center text-muted">No game services recorded yet.</td>
											</tr>
										<% } %>
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<style>
	.filter-breadcrumb-services {
    margin-top: 1rem;
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
}
.filter-breadcrumb-services .filter-link {
    padding: 0.35rem 0.9rem;
    border-radius: 999px;
    border: 1px solid var(--bs-primary);
    color: var(--bs-primary);
    text-decoration: none;
    letter-spacing: 0.5px;
    font-size: 0.85rem;
}
.filter-breadcrumb-services .filter-link.active {
    background: var(--bs-primary);
    color: #fff;
}
</style>
<script>
	document.addEventListener('DOMContentLoaded', () => {
		const filterLinks = document.querySelectorAll('#fnb-hotel-filter .filter-link');
		const tableBodyRows = document.querySelectorAll('#fnb-hotel-table tbody tr[data-service-type]');

		const updateFilter = (filter) => {
			tableBodyRows.forEach((row) => {
				const rowType = row.dataset.serviceType?.toLowerCase() || '';
				row.style.display = filter === 'all' || rowType === filter ? '' : 'none';
			});
		};

		filterLinks.forEach((link) => {
			link.addEventListener('click', (event) => {
				event.preventDefault();
				const selectedFilter = link.dataset.filter;
				if (!selectedFilter) return;
				filterLinks.forEach((otherLink) => otherLink.classList.remove('active'));
				link.classList.add('active');
				updateFilter(selectedFilter);
			});
		});
	});
</script>
<%- include('../partials/footer') %>
<%- include('../modals/junket/new_service_record') %>

